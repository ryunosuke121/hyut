# hyut - macOS メモアプリ 要件定義書

## 1. プロジェクト概要

### 背景
Raycast Memo を使用しているが、以下の不満がある：
- 無料プランではドキュメント数に制限がある 
- メモの管理（分類・検索・整理）が行いづらい

一方で、以下の体験は気に入っている：
- Markdownをレンダリングして表示できる
- グローバルショートカットでポップアップを起動し、素早く書いて閉じられる

これらの良い点を活かしつつ、不満点を解消する**自分専用のメモアプリ**を開発する。

### ゴール
- ドキュメント数の制限がない
- フォルダ・タグ・全文検索によるメモ管理が可能
- ショートカットで瞬時に起動・記入・終了できる快適な操作感

---

## 2. 技術スタック

| 項目 | 選定 | 理由 |
|------|------|------|
| フレームワーク | Tauri v2 + React + TypeScript | macOSネイティブウィンドウ制御、豊富なエディタライブラリ、Rustバックエンド |
| エディタ | Tiptap (ProseMirror ベース) | WYSIWYG Markdownエディタ。拡張性が高い |
| データ保存 | ローカル Markdown ファイル (.md) | 他ツール（VS Code, Obsidian等）でも編集可能。ポータビリティ重視 |
| メタデータ | YAML frontmatter | タグ・作成日時などをファイル内に埋め込み。ポータブル |
| macOSネイティブAPI | objc2 + objc2-app-kit | ウィンドウレベル制御、Space間表示、アクティベーションポリシー |

## 3. 機能要件

### Phase 1: MVP（最小限の製品）

ショートカットで起動して、Markdownメモを書いて保存できる状態。

#### 3.1 グローバルショートカット起動
- macOS 全体で有効なキーボードショートカット（デフォルト: `Cmd+Shift+M`）でウィンドウの表示/非表示をトグルできる
- デフォルトショートカットキーは設定で変更可能
- ショートカットはキーを押した瞬間のみ反応する（離した時には反応しない）

#### 3.2 フローティングウィンドウ
- 画面中央にポップアップ形式で表示
- 他のアプリの上にフロートする
- **どのデスクトップ（Space）にいてもショートカットでその場に呼び出せる**（Raycast Memoと同等の挙動）
- **フルスクリーンアプリの上にも表示される**
- アプリはDockに表示されない（アクセサリアプリとして動作）
- Escキーまたはフォーカス喪失で非表示になる
- macOSネイティブのタイトルバーをオーバーレイ表示し、標準の信号機ボタン（閉じる/最小化/最大化）を表示する
- タイトルバー領域でウィンドウをドラッグ移動可能
- ウィンドウサイズはリサイズ可能（最小: 500x400、デフォルト: 900x700）

#### 3.3 Markdownエディタ（リアルタイムプレビュー）
- WYSIWYG風のリアルタイムプレビューエディタ（Typora風）
- 書きながらMarkdownがレンダリングされる
- 対応する Markdown 記法:
  - 見出し（h1〜h6）
  - 太字・斜体・取り消し線
  - リスト（箇条書き・番号付き）
  - チェックボックス
  - コードブロック（シンタックスハイライト付き）
  - インラインコード
  - リンク
  - 画像（ローカルパス・URL）
  - 引用
  - テーブル
  - 水平線

#### 3.4 ファイル保存
- 保存先: 固定の1ディレクトリ（デフォルト: `~/hyut`）
- 保存先ディレクトリは設定で変更可能
- ファイル形式: `.md`（プレーンな Markdown + YAML frontmatter）
- 自動保存（入力停止後1秒のデバウンスで自動的にファイルへ書き出す）
- メモ切り替え時・ウィンドウ非表示時に保存をフラッシュする
- ファイル名: UUID ベースで自動生成（衝突を回避）
- タイトルはMarkdown本文のH1見出し、またはH1がなければ先頭テキストから自動抽出

#### 3.5 メモの新規作成・一覧表示
- 新規メモの作成（`Cmd+N` ショートカット対応）
- メモ一覧をサイドバーに表示（更新日時の降順）
- 各メモにタイトルと相対時刻を表示
- メモの削除機能
- 起動時は前回の状態を復元（最後に開いていたメモを自動的に開く）
- ウィンドウ表示時にエディタへ自動フォーカス

---

### Phase 2: 管理機能

#### 3.6 フォルダ管理
- 保存先ディレクトリ内のサブフォルダ＝フォルダとして扱う
- フォルダの作成・名前変更・削除
- メモのフォルダ間移動
- サイドバーでフォルダツリー表示

#### 3.7 タグ機能
- YAML frontmatter の `tags` フィールドでタグ管理
- タグの追加・削除をUI上で行える
- タグ一覧の表示
- タグによるフィルタリング

```yaml
---
tags: [work, idea, project-x]
created: 2025-01-15T10:30:00
modified: 2025-01-15T14:20:00
---
```

#### 3.8 全文検索
- メモの内容を横断的に検索
- インクリメンタルサーチ（入力に応じてリアルタイムで結果表示）
- 検索結果にマッチ箇所のハイライト表示

---

### Phase 3: 将来的な拡張（スコープ外だが記録）

以下は現時点では不要だが、将来的に検討し得る機能:
- ピン留め（お気に入り）
- エクスポート機能（PDF/HTML）
- 画像のペースト・添付管理
- メモ間のリンク（Wiki-link）
- バージョン履歴
- iCloud同期

---

## 4. 非機能要件

### 4.1 パフォーマンス
- アプリ起動（ショートカットからウィンドウ表示まで）: 200ms 以内
- メモの保存: バックグラウンドで即座に実行
- 検索: 1000件のメモに対して100ms以内にレスポンス

### 4.2 データポータビリティ
- すべてのデータはローカルの Markdown ファイルとして保存
- YAML frontmatter は広く使われている形式に準拠
- 特定のアプリにロックインされない

### 4.3 プライバシー
- ネットワーク通信は行わない（完全オフライン動作）
- データは全てローカルに保存

### 4.4 UX
- macOS ネイティブの見た目・操作感に馴染むデザイン
- ダークモード・ライトモードはmacOSのシステム設定に自動追従
- キーボードだけで主要な操作が完結できる
- 2ペインレイアウト（左: サイドバー、右: エディタ）

---

## 5. YAML frontmatter 仕様

すべてのメモファイルは以下の frontmatter を持つ:

```yaml
---
id: "550e8400-e29b-41d4-a716-446655440000"
created_at: 2025-01-15T10:30:00Z
updated_at: 2025-01-15T14:20:00Z
---
```

| フィールド | 型 | 必須 | 説明 |
|-----------|-----|------|------|
| id | UUID string | Yes | メモの一意識別子（ファイル名と一致） |
| created_at | ISO 8601 datetime (UTC) | Yes | 作成日時（自動設定） |
| updated_at | ISO 8601 datetime (UTC) | Yes | 最終更新日時（自動更新） |

※ タイトルはfrontmatterに持たず、Markdown本文から動的に抽出する（H1見出し or 先頭テキスト）
※ tags フィールドは Phase 2 で追加予定

---

## 6. 開発フェーズ

| フェーズ | 内容 | 目標 |
|---------|------|------|
| Phase 1 (MVP) | ショートカット起動、フローティングウィンドウ、Markdownエディタ、ファイル保存、メモ一覧、状態復元 | まず書ける状態にする |
| Phase 2 | フォルダ管理、タグ機能、全文検索 | メモを効率的に管理できる |
| Phase 3 | ピン留め、エクスポート、Wiki-link等 | 必要に応じて随時追加 |
